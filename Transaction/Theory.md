# Теорія: Як обробляється транзакція в блокчейні

## Вступ

Цей документ пояснює, як працюють транзакції в блокчейні, починаючи від створення транзакції до її включення в блок. Пояснення базується на принципах роботи Bitcoin та загальних концепціях блокчейн-технологій.

---

## 1. Що таке транзакція?

**Транзакція** - це переказ криптовалюти від одного користувача до іншого. Це основна одиниця передачі цінності в блокчейні.

Кожна транзакція містить:
- **Адресу відправника** - звідки йдуть кошти
- **Адресу отримувача** - куди йдуть кошти
- **Суму переказу** - скільки монет передається
- **Комісію** - винагорода майнеру за включення транзакції в блок
- **Цифровий підпис** - доказ того, що транзакцію створив власник коштів
- **Timestamp** - час створення транзакції

### Чому транзакції важливі?

Транзакції - це серце будь-якого блокчейну. Без них блокчейн був би просто порожнім ланцюгом блоків без реальної цінності. Саме транзакції:
- Переміщують цінність між учасниками мережі
- Створюють історію всіх переказів
- Забезпечують прозорість та відстежуваність коштів

---

## 2. Як створюється транзакція?

### Крок 1: Ініціація транзакції

Користувач вирішує відправити кошти іншому користувачу. Для цього потрібно:
1. Мати гаманець з достатнім балансом
2. Знати адресу отримувача
3. Вказати суму переказу
4. Встановити комісію за транзакцію

### Крок 2: Формування даних транзакції

Гаманець створює структуру транзакції, яка містить:
```
Від: [адреса відправника]
До: [адреса отримувача]
Сума: [кількість монет]
Комісія: [винагорода майнеру]
Час: [timestamp]
```

### Крок 3: Підпис транзакції

Це найважливіший етап! Користувач підписує транзакцію своїм **приватним ключем**.

**Чому це важливо?**
- Підпис доводить, що транзакцію створив саме власник коштів
- Ніхто інший не може створити валідний підпис без приватного ключа
- Після підпису транзакцію неможливо змінити (будь-яка зміна зробить підпис невалідним)

---

## 3. Що таке цифровий підпис?

**Цифровий підпис** - це математичний механізм, який доводить автентичність даних.

### Як працює цифровий підпис?

В блокчейні використовується **асиметрична криптографія**:

1. **Приватний ключ** - секретна інформація, яку знає тільки власник
   - Використовується для створення підпису
   - НІКОЛИ не передається іншим особам
   - Якщо хтось отримає ваш приватний ключ - він отримає доступ до всіх ваших коштів!

2. **Публічний ключ** - відкрита інформація, яку всі можуть бачити
   - Використовується для перевірки підпису
   - Можна вільно розповсюджувати
   - З публічного ключа генерується адреса гаманця

### Процес підпису:

```
Дані транзакції + Приватний ключ → [математична функція] → Цифровий підпис
```

### Процес перевірки:

```
Дані транзакції + Публічний ключ + Підпис → [перевірка] → ✓ Валідно / ✗ Невалідно
```

### Властивості цифрового підпису:

- **Автентичність** - підпис може створити тільки власник приватного ключа
- **Цілісність** - будь-яка зміна даних робить підпис невалідним
- **Незаперечність** - власник не може заперечувати, що створив підпис

---

## 4. Як транзакція потрапляє в Mempool?

**Mempool** (Memory Pool) - це "зала очікування" для неопрацьованих транзакцій. Це тимчасове сховище в пам'яті кожного вузла мережі.

### Процес додавання в Mempool:

#### Крок 1: Розсилка по мережі

Після створення та підпису, транзакція надсилається в мережу блокчейн:
- Гаманець відправляє транзакцію на найближчі вузли (ноди)
- Кожен вузол отримує транзакцію і перевіряє її

#### Крок 2: Валідація транзакції

Перед додаванням в mempool кожен вузол перевіряє:

✓ **Перевірка підпису**
- Чи підпис дійсний?
- Чи транзакцію підписав власник коштів?

✓ **Перевірка балансу**
- Чи має відправник достатньо коштів?
- Враховуються всі попередні транзакції

✓ **Перевірка формату**
- Чи правильна структура транзакції?
- Чи всі обов'язкові поля заповнені?

✓ **Перевірка комісії**
- Чи вказана комісія достатня?
- Чи не від'ємна комісія?

✓ **Перевірка на дублювання**
- Чи ця транзакція вже є в mempool?
- Чи вона вже була включена в блок раніше?

#### Крок 3: Додавання в Mempool

Якщо всі перевірки пройшли успішно:
- Транзакція додається в локальний mempool вузла
- Вузол розсилає транзакцію далі своїм сусідам
- Так транзакція розповсюджується по всій мережі

### Скільки транзакція чекає в Mempool?

Це залежить від кількох факторів:
- **Розмір комісії** - чим більша комісія, тим швидше майнер включить транзакцію
- **Навантаження мережі** - якщо багато транзакцій, доведеться чекати довше
- **Розмір транзакції** - більші транзакції потребують більшої комісії

**Важливо:** Транзакція в mempool ще НЕ є підтвердженою. Вона стає підтвердженою тільки після включення в блок!

---

## 5. Як майнер включає транзакцію в блок?

**Майнер** - це вузол мережі, який створює нові блоки та отримує за це винагороду.

### Процес створення блоку:

#### Крок 1: Вибір транзакцій з Mempool

Майнер дивиться на всі транзакції в своєму mempool і вибирає найвигідніші:

```
Сортування за комісією: від найбільшої до найменшої
```

**Чому майнер обирає транзакції з найбільшою комісією?**
- Комісії - це заробіток майнера
- Блок має обмежений розмір (наприклад, 1 МБ в Bitcoin)
- Майнер хоче максимізувати свій прибуток

Типовий блок містить:
- Сотні або тисячі транзакцій
- Транзакції з високою комісією включаються першими
- Транзакції з низькою комісією можуть чекати довго

#### Крок 2: Створення Coinbase транзакції

Перша транзакція в блоці - це **винагорода майнера**:
- Ці монети створюються "з повітря" (емісія нової валюти)
- Складається з: блок-винагороди + сума всіх комісій
- Не потребує підпису, бо немає відправника

Приклад:
```
Винагорода за блок: 6.25 BTC
+ Сума комісій: 0.5 BTC
= Загальна винагорода: 6.75 BTC
```

#### Крок 3: Майнінг блоку (Proof of Work)

Після формування списку транзакцій, майнер починає "майнити" блок:

**Що таке майнінг?**
- Пошук спеціального числа (Nonce), яке робить хеш блоку валідним
- Хеш має починатись з певної кількості нулів (залежить від складності)
- Це потребує величезної обчислювальної потужності

Процес майнінгу:
```
1. Nonce = 0
2. Хеш = SHA256(блок + Nonce)
3. Якщо хеш починається з потрібної кількості нулів → готово!
4. Якщо ні → Nonce++, повторити крок 2
```

Майнер може перебрати мільйони або мільярди варіантів, перш ніж знайти правильний Nonce!

#### Крок 4: Розсилка блоку в мережу

Коли блок змайнено:
- Майнер відправляє блок в мережу
- Інші вузли перевіряють валідність блоку
- Якщо блок валідний, всі додають його до свого блокчейну
- Транзакції з цього блоку видаляються з mempool

---

## 6. Чому перевірка підпису важлива?

Перевірка цифрового підпису - це **критично важливий** елемент безпеки блокчейну.

### Що відбувається при перевірці?

Кожен вузол мережі та майнери перевіряють підпис кожної транзакції:

```
Дані транзакції + Публічний ключ відправника + Підпис → Перевірка → ✓/✗
```

### Чому це важливо?

#### 1. Захист від крадіжки

Без перевірки підпису:
- ✗ Будь-хто міг би створити транзакцію з чужого гаманця
- ✗ Хакери могли б красти кошти без доступу до приватного ключа
- ✗ Блокчейн не мав би ніякої цінності

З перевіркою підпису:
- ✓ Тільки власник приватного ключа може створити валідну транзакцію
- ✓ Кошти захищені криптографічно
- ✓ Навіть якщо хтось бачить вашу транзакцію, він не може її підробити

#### 2. Незмінність даних

Підпис гарантує, що транзакцію не можна змінити:
- Якщо хтось спробує змінити суму або адресу отримувача
- Підпис стане невалідним
- Транзакція буде відхилена мережею

#### 3. Довіра без посередників

В традиційних системах:
- Банк перевіряє вашу особу
- Платіжна система підтверджує транзакцію
- Потрібно довіряти третій стороні

В блокчейні:
- Математика доводить власність
- Не потрібно довіряти нікому
- Система працює автоматично

### Що відбувається при невалідному підписі?

Якщо підпис не проходить перевірку:
- ✗ Транзакція відхиляється вузлом
- ✗ Не додається в mempool
- ✗ Ніколи не потрапить в блок
- ✗ Інші вузли навіть не розглядатимуть цю транзакцію

---

## 7. Правила валідації блокчейну

Кожен блок і транзакція повинні проходити суворі правила валідації:

### Правила для транзакцій:

#### 1. Правило підпису
- ✓ Транзакція має бути підписана валідним приватним ключем
- ✓ Підпис має відповідати публічному ключу відправника

#### 2. Правило балансу
- ✓ У відправника має бути достатньо коштів
- ✓ Враховуються всі попередні транзакції в блокчейні
- ✓ Не можна витратити більше, ніж є

#### 3. Правило формату
- ✓ Сума має бути більше нуля
- ✓ Адреси мають бути правильного формату
- ✓ Всі обов'язкові поля заповнені

#### 4. Правило запобігання подвійної витрати
- ✓ Ті самі кошти не можуть бути витрачені двічі
- ✓ Перевіряється історія всіх транзакцій

#### 5. Правило комісії
- ✓ Комісія не може бути від'ємною
- ✓ Сума транзакції + комісія ≤ баланс відправника

### Правила для блоків:

#### 1. Правило хешу
- ✓ Хеш блоку має відповідати його вмісту
- ✓ Хеш має починатись з потрібної кількості нулів (складність)

#### 2. Правило зв'язку
- ✓ Кожен блок має містити хеш попереднього блоку
- ✓ Це створює незламний ланцюг блоків

#### 3. Правило timestamp
- ✓ Час блоку має бути логічним (не в майбутньому)
- ✓ Має бути пізніше попереднього блоку

#### 4. Правило розміру
- ✓ Блок не може перевищувати максимальний розмір
- ✓ В Bitcoin це 1 МБ (4 МБ з SegWit)

#### 5. Правило винагороди
- ✓ Coinbase транзакція має бути правильного розміру
- ✓ Винагорода = блок-винагорода + сума комісій
- ✓ Не може бути більше дозволеної емісії

#### 6. Правило транзакцій
- ✓ Всі транзакції в блоці мають бути валідними
- ✓ Кожна транзакція перевіряється окремо
- ✓ Немає дублікатів транзакцій

### Консенсус мережі

Для того, щоб блок був прийнятий:
- Більшість вузлів мережі мають погодитись
- Всі правила валідації мають бути виконані
- Блок має бути змайнений правильно (Proof of Work)

**Що відбувається при порушенні правил?**
- Невалідний блок відхиляється всією мережею
- Майнер не отримує винагороду
- Ланцюг продовжується з останнього валідного блоку

---

## 8. Незворотність транзакцій

### Чому транзакції незворотні?

Після того як транзакція включена в блок:
- Вона стає частиною блокчейну
- Змінити її неможливо без перебудови всього ланцюга
- Це потребувало б більше 51% обчислювальної потужності мережі

### Підтвердження транзакцій

Кожен новий блок - це додаткове підтвердження:
- **1 підтвердження** - транзакція в новому блоці
- **3 підтвердження** - над транзакцією 2 додаткових блоки
- **6+ підтверджень** - вважається повністю безпечним

Чим більше підтверджень, тим складніше відмінити транзакцію.

### Важливість для користувачів

Користувачі повинні розуміти:
- ⚠️ Перед відправкою перевіряйте адресу двічі
- ⚠️ Після відправки повернути кошти неможливо
- ⚠️ Працюйте тільки з перевіреними контрагентами
- ⚠️ Невеликі суми можна приймати після 1 підтвердження
- ⚠️ Великі суми - чекайте 6+ підтверджень

---

## 9. Захист та конфіденційність

### Особиста відповідальність

В блокчейні ви - самі відповідаєте за свої кошти:
- Ніхто не може відновити втрачений приватний ключ
- Немає служби підтримки, яка поверне кошти
- Резервне копіювання приватного ключа - ваша відповідальність

### Публічність транзакцій

Важливо розуміти:
- ✓ Всі транзакції публічні та видимі
- ✓ Будь-хто може побачити адресу та суму
- ✓ Адреси анонімні до розкриття особи

### Рекомендації з безпеки

1. **Захист приватного ключа**
   - Ніколи не передавайте його нікому
   - Зберігайте в безпечному місці
   - Використовуйте апаратні гаманці для великих сум

2. **Приватність**
   - Використовуйте нову адресу для кожної транзакції
   - Не розкривайте зв'язок між адресами
   - Будьте обережні з особистою інформацією

3. **Операційна безпека**
   - Перевіряйте адреси перед відправкою
   - Використовуйте тестові транзакції для великих сум
   - Чекайте достатню кількість підтверджень

---

## Висновок

Система обробки транзакцій в блокчейні - це складний, але елегантний механізм, який:

✅ Дозволяє надійно переказувати цінність без посередників
✅ Захищає користувачів за допомогою криптографії
✅ Створює прозору та перевірену історію всіх операцій
✅ Забезпечує децентралізацію та стійкість системи

Розуміння цих процесів допомагає:
- Безпечно використовувати криптовалюти
- Усвідомлювати ризики та обмеження
- Приймати правильні рішення при роботі з блокчейном

---

## Джерела інформації

Ця теоретична частина базується на інформації з:
1. Bitcoin.org - офіційний ресурс про Bitcoin
2. Концепції роботи mempool в блокчейн-мережах
3. Загальні принципи криптографії та розподілених систем

**Дата створення:** 26 листопада 2025

---

*Документ створено як частину практичного завдання з блокчейн-технологій*
